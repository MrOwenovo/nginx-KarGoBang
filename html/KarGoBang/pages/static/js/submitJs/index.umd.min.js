!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).YuyanMonitor=e()}(this,(function(){"use strict";function t(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function e(e){for(var n=1;arguments.length>n;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?t(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){for(var n=0;e.length>n;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function c(t){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},c(t)}function s(t,e){return s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},s(t,e)}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function f(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return u(t)}function l(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=c(t);if(e){var o=c(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return f(this,n)}}function d(t){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},d(t)}function p(t,e){for(var n=0;e.length>n;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function h(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var a,c=t[Symbol.iterator]();!(r=(a=c.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{r||null==c.return||c.return()}finally{if(o)throw i}}return n}(t,e)||g(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||g(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){if(t){if("string"==typeof t)return m(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);e>n;n++)r[n]=t[n];return r}var y=function(t){return function(){if(!t||!t.navigator||!t.navigator.userAgent)return"";var e=t.navigator.userAgent,n="";return!!e.match(/iphone|ipad|iPod/gi)&&(n="iOS"),!!e.match(/android/gi)&&(n="Android"),!!e.match(/Firefox/gi)&&(n="Firefox"),!!e.match(/Chrome/gi)&&(n="Chrome"),!e.match(/Chrome/gi)&&!!e.match(/Safari/gi)&&(n="Safari"),!!e.match(/Opera/gi)&&(n="Opera"),!!e.match(/MSIE/gi)&&(n="IE"),n}}(void 0);function b(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}function w(t,e,n,r,o,i){return b((a=b(b(e,t),b(r,i)))<<(c=o)|a>>>32-c,n);var a,c}function E(t,e,n,r,o,i,a){return w(e&n|~e&r,t,e,o,i,a)}function S(t,e,n,r,o,i,a){return w(e&r|n&~r,t,e,o,i,a)}function C(t,e,n,r,o,i,a){return w(e^n^r,t,e,o,i,a)}function A(t,e,n,r,o,i,a){return w(n^(e|~r),t,e,o,i,a)}function O(t,e){var n,r,o,i,a;t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;var c=1732584193,s=-271733879,u=-1732584194,f=271733878;for(n=0;t.length>n;n+=16)r=c,o=s,i=u,a=f,c=E(c,s,u,f,t[n],7,-680876936),f=E(f,c,s,u,t[n+1],12,-389564586),u=E(u,f,c,s,t[n+2],17,606105819),s=E(s,u,f,c,t[n+3],22,-1044525330),c=E(c,s,u,f,t[n+4],7,-176418897),f=E(f,c,s,u,t[n+5],12,1200080426),u=E(u,f,c,s,t[n+6],17,-1473231341),s=E(s,u,f,c,t[n+7],22,-45705983),c=E(c,s,u,f,t[n+8],7,1770035416),f=E(f,c,s,u,t[n+9],12,-1958414417),u=E(u,f,c,s,t[n+10],17,-42063),s=E(s,u,f,c,t[n+11],22,-1990404162),c=E(c,s,u,f,t[n+12],7,1804603682),f=E(f,c,s,u,t[n+13],12,-40341101),u=E(u,f,c,s,t[n+14],17,-1502002290),c=S(c,s=E(s,u,f,c,t[n+15],22,1236535329),u,f,t[n+1],5,-165796510),f=S(f,c,s,u,t[n+6],9,-1069501632),u=S(u,f,c,s,t[n+11],14,643717713),s=S(s,u,f,c,t[n],20,-373897302),c=S(c,s,u,f,t[n+5],5,-701558691),f=S(f,c,s,u,t[n+10],9,38016083),u=S(u,f,c,s,t[n+15],14,-660478335),s=S(s,u,f,c,t[n+4],20,-405537848),c=S(c,s,u,f,t[n+9],5,568446438),f=S(f,c,s,u,t[n+14],9,-1019803690),u=S(u,f,c,s,t[n+3],14,-187363961),s=S(s,u,f,c,t[n+8],20,1163531501),c=S(c,s,u,f,t[n+13],5,-1444681467),f=S(f,c,s,u,t[n+2],9,-51403784),u=S(u,f,c,s,t[n+7],14,1735328473),c=C(c,s=S(s,u,f,c,t[n+12],20,-1926607734),u,f,t[n+5],4,-378558),f=C(f,c,s,u,t[n+8],11,-2022574463),u=C(u,f,c,s,t[n+11],16,1839030562),s=C(s,u,f,c,t[n+14],23,-35309556),c=C(c,s,u,f,t[n+1],4,-1530992060),f=C(f,c,s,u,t[n+4],11,1272893353),u=C(u,f,c,s,t[n+7],16,-155497632),s=C(s,u,f,c,t[n+10],23,-1094730640),c=C(c,s,u,f,t[n+13],4,681279174),f=C(f,c,s,u,t[n],11,-358537222),u=C(u,f,c,s,t[n+3],16,-722521979),s=C(s,u,f,c,t[n+6],23,76029189),c=C(c,s,u,f,t[n+9],4,-640364487),f=C(f,c,s,u,t[n+12],11,-421815835),u=C(u,f,c,s,t[n+15],16,530742520),c=A(c,s=C(s,u,f,c,t[n+2],23,-995338651),u,f,t[n],6,-198630844),f=A(f,c,s,u,t[n+7],10,1126891415),u=A(u,f,c,s,t[n+14],15,-1416354905),s=A(s,u,f,c,t[n+5],21,-57434055),c=A(c,s,u,f,t[n+12],6,1700485571),f=A(f,c,s,u,t[n+3],10,-1894986606),u=A(u,f,c,s,t[n+10],15,-1051523),s=A(s,u,f,c,t[n+1],21,-2054922799),c=A(c,s,u,f,t[n+8],6,1873313359),f=A(f,c,s,u,t[n+15],10,-30611744),u=A(u,f,c,s,t[n+6],15,-1560198380),s=A(s,u,f,c,t[n+13],21,1309151649),c=A(c,s,u,f,t[n+4],6,-145523070),f=A(f,c,s,u,t[n+11],10,-1120210379),u=A(u,f,c,s,t[n+2],15,718787259),s=A(s,u,f,c,t[n+9],21,-343485551),c=b(c,r),s=b(s,o),u=b(u,i),f=b(f,a);return[c,s,u,f]}function I(t){var e,n="",r=32*t.length;for(e=0;r>e;e+=8)n+=String.fromCharCode(t[e>>5]>>>e%32&255);return n}function _(t){var e,n=[];for(n[(t.length>>2)-1]=void 0,e=0;n.length>e;e+=1)n[e]=0;var r=8*t.length;for(e=0;r>e;e+=8)n[e>>5]|=(255&t.charCodeAt(e/8))<<e%32;return n}function j(t){var e,n,r="0123456789abcdef",o="";for(n=0;t.length>n;n+=1)e=t.charCodeAt(n),o+=r.charAt(e>>>4&15)+r.charAt(15&e);return o}function P(t){return unescape(encodeURIComponent(t))}function T(t){return function(t){return I(O(_(t),8*t.length))}(P(t))}function k(t,e){return function(t,e){var n,r,o=_(t),i=[],a=[];for(i[15]=a[15]=void 0,o.length>16&&(o=O(o,8*t.length)),n=0;16>n;n+=1)i[n]=909522486^o[n],a[n]=1549556828^o[n];return r=O(i.concat(_(e)),512+8*e.length),I(O(a.concat(r),640))}(P(t),P(e))}function L(t,e,n){return e?n?k(e,t):j(k(e,t)):n?T(t):j(T(t))}var M=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.env=e||y(),this.stackFilter=function(t){switch(t){case"iOS":return{filter:function(t){return 0>t.indexOf("[native code]")&&t.indexOf("@")>=0}};case"Android":return{filter:function(t,e){return e&&0>t.indexOf("nonymous")&&!0}};default:return{filter:function(){return!0}}}}(this.env).filter}var e,n,r;return e=t,(n=[{key:"makeReg",value:function(){return"iOS"===this.env?/(?:\s*)\w+(?=@)|(?:@).*?(?=:\d*:)|(?::)\d*(?=:)|(?::)\d*$/g:null}},{key:"stackFormatter",value:function(t){var e=t.message,n=[],r="Android"===this.env,o="iOS"===this.env,i=t.stack.split("\n").filter(this.stackFilter);i.shift();var a=i.join("\n"),c=this.makeReg();return c?i.map((function(t){var e=t.match(c);if(e){var i=h(e,4),a=i[0],s=void 0===a?"":a,u=i[1],f=void 0===u?"":u,l=i[2],d=void 0===l?"":l,p=i[3],v=void 0===p?"":p,g=r?s.split(".").reverse()[0]:s,m=o?1:0;n.push("at ".concat(g," (").concat(f.substr(m),":").concat(d.substr(m),":").concat(v.substr(m),")"))}else n.push(t);return null})):n=i,{hash:this.encryptStack(e,n),message:e,stackList:n,stackStr:a}}},{key:"encryptStack",value:function(t,e){var n=[].concat(v(e.slice(0,6)),v(e.slice(7,8)),v(e.slice(9,10)),v(e.slice(11,12)),v(e.slice(13,14))).join(";");return L("".concat(t,":").concat(n))}}])&&p(e.prototype,n),r&&p(e,r),t}(),F=/^\s*at .*? ?\(((?:file|https?|blob|chrome-extension|native|eval|<anonymous>).*?)(?::\d+)?(?::\d+)?\)?\s*$/i,R=/^\s*.*?(?:\(.*?\))?(?:^|@)((?:file|https?|blob|chrome|resource|\[native).*?)(?::\d+)?(?::\d+)?\s*$/i,B=/^\s*at (?:(?:\[object object\])?.+ )?\(?((?:file|ms-appx|https?|blob):.*?):\d+(?::\d+)?\)?\s*$/i;"undefined"==typeof process||d(process);var x=function(t){return function(t){for(var e=t.slice(0,20),n=["",""],r={},o=1,i=0;e.length>i;i+=1){var a=F,c=(e[i]||"").match(a);if(null===c&&(c=(e[i]||"").match(a=R)),null===c&&(c=(e[i]||"").match(a=B)),null!==c){var s=c[1],u=r[s];void 0===u&&(r[s]="#".concat(o,"#"),o+=1,u=r[s]),e[i]=e[i].replace(s,u)}}e.length>0&&(n[1]=e.map((function(t){return t.trim()})).join(""));var f="";for(var l in r)r.hasOwnProperty(l)&&(f+="".concat(l,"@").concat(r[l],";"));return f=f.replace(/;$/,""),n[0]=f,n.join("").replace(/\^/g,"").replace(/=/g,"").replace(/,/g,"")}(t)};function N(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function D(t){for(var e=1;arguments.length>e;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?N(Object(n),!0).forEach((function(e){J(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function H(t){return H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},H(t)}function q(t,e){for(var n=0;e.length>n;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function J(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function U(t){return function(t){if(Array.isArray(t))return z(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return z(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return z(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);e>n;n++)r[n]=t[n];return r}function $(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(!e.length)return!0;for(var r=0;e.length>r;r++){var o=e[r];if(null==t[o])return n&&n('Field "'.concat(o,'" is required. Log cached.')),!1}return!0}function Y(t,e){if(!e||"object"!==H(e))return t;var n=t||{};for(var r in e)e.hasOwnProperty(r)&&void 0!==e[r]&&(n[r]=e[r]);return n}function K(t,e){for(var n=e.split("."),r=0;n.length-1>r;r++)if("object"!==H(t=t[n[r]])||!t||Array.isArray(t))return"";return t[n.pop()]}function Q(t,e,n){for(var r=e.split("."),o=0;r.length-1>o;o++){if("object"!==H(t[r[o]])&&void 0!==t[r[o]])return;if(Array.isArray(t[r[o]]))return;t[r[o]]||(t[r[o]]={}),t=t[r[o]]}t[r.pop()]=n}var V=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.defaults=void 0,this.configs=void 0,this.defaults={},this.configs={}}var e,n,r;return e=t,(n=[{key:"set",value:function(t,e,n){void 0!==n?(this.defaults[t]=n,this.configs[t]=e):(this.defaults[t]=e,delete this.configs[t])}},{key:"process",value:function(t){var e;for(var n in t=Y({},t),this.defaults)if(this.defaults.hasOwnProperty(n))switch(this.configs[n]){case"call":Q(t,n,this.defaults[n].call(this,K(t,n),t));break;case"make":void 0===K(t,n)&&Q(t,n,this.defaults[n].call(this,t));break;case"append":var r=K(t,n);Array.isArray(r)||(r=[]),(e=r).push.apply(e,U(this.defaults[n])),Q(t,n,r);break;default:void 0===K(t,n)&&Q(t,n,this.defaults[n])}return t}}])&&q(e.prototype,n),r&&q(e,r),t}();function G(t,e){return t&&t.getAttribute&&t.getAttribute(e)||""}var W,X={};function Z(t){console&&console.warn&&console.warn(t)}function tt(t,e){X[t]||(X[t]=1,Z("配置项 [".concat(t,"] 已不推荐使用。请使用 [").concat(e,"]。")))}function et(){var t,e;return W||(t=new V,e=function(){var t={};for(var e in rt)if(rt.hasOwnProperty(e)){var n=nt(rt[e]);n&&(t[e]=n)}return t}(),t.set("yuyanId","call",(function(t){return t||e.yuyanId})),t.set("bmAppid","call",(function(t,n){return n.yuyanId?(Z("已设置yuyanId，其他 id 将不生效"),null):t?(tt("bmAppid","_appId"),t):n.appid?(tt("appid","_appId"),n.appid):n._appId||e._appId})),t.set("userId","call",(function(t,e){return e.roleId?(tt("roleId","userId"),e.roleId):t})),t.set("disableInterface","call",(function(t){return t||!1})),t.set("oncePerSession","call",(function(t){return t||!1})),t.set("autoCapture","call",(function(t,e){return!e.hasOwnProperty("autoCapture")||!!e.autoCapture})),t.set("defaults","call",(function(t){return Y({},t)})),t.set("sprintId","call",(function(t){return t||e.sprintId})),t.set("requiredFields","call",(function(t){return Array.isArray(t)?t:"string"==typeof t?[t]:[]})),t.set("eventId","call",(function(t,e){return"PC"===e.appType?"102022":"102023"})),t.set("beforeLog","call",(function(t){if("function"==typeof t)return t})),t.set("callBridge","call",(function(t){if("function"==typeof t)return t})),t.set("plugins","call",(function(t){return Array.isArray(t)?t:["tracert","performance","buc"]})),t.set("forceHttpReport","call",(function(t){return!!t})),W=t),W}var nt=function(t){return function(e){var n;if(!(null==t||null===(n=t.document)||void 0===n?void 0:n.querySelectorAll))return"";for(var r=function(t){var e,n;try{return[].slice.call(t)}catch(o){e=[],n=t.length;for(var r=0;n>r;r++)e.push(t[r]);return e}}(t.document.querySelectorAll("meta")),o=0;r.length>o;o++){var i=r[o];if(G(i,"name")===e)return G(i,"content")}return null}}(eval?(0,eval)("this"):global||window),rt={_appId:"bm_app_id",yuyanId:"yuyan_id",sprintId:"bm_sprint_id"};var ot={JS:1,REQUEST:2,PROMISEREJECTION:3,ASSETS:4},it=Object.freeze({__proto__:null,ErrorCodeEnums:ot,CodeLevelEnums:{B:"禁用",L:"低",M:"中",H:"高"}}),at=new M;var ct={};var st=function(t){var e={is:!1,name:"",version:""},n=t.match(/AliApp\S+\b\)/gi);e.is=!!/(T-UA)|(TBIOS)|(WindVane)|(AliApp)/i.test(t);try{e.name=n?n[0].match(/\(\w+\-*\w*/)[0].split("(")[1]:"",e.version=n?n[0].match(/(\d+\.*)+/gi)[0]:""}catch(t){}return e},ut=function(t){return encodeURIComponent(t).replace(/'/g,"%27")};function ft(){var t=new Date,e=function(t){return 10>t?"0".concat(t):"".concat(t)};return"".concat(t.getFullYear(),"-").concat(e(t.getMonth()+1),"-").concat(e(t.getDate())," ").concat(e(t.getHours()),":").concat(e(t.getMinutes()),":").concat(e(t.getSeconds()),":").concat(t.getMilliseconds())}function lt(t){if(!t||"object"!==n(t))return[];var e=t.eventId,r=t.userId,o=t.ua,i=t.param4,a=["D-AE",ft(),"","","2","","",r,"1000",e,"H5behavior","2","","","","","","","","","","","","","","","","","",o,"","","","","",""];return a.push(function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"^",r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=[];if(t instanceof Array)o=t;else if(t instanceof Object){var i=r?ut:function(t){return t};for(e in t)if(t.hasOwnProperty(e)){var a=i(t[e]);o.push("".concat(e,"=").concat(a))}}return o.join(n)}(i,"^",!0)),a}function dt(t,e){var r=t||{};if(!e||"object"!==n(e))return r;for(var o in e)e.hasOwnProperty(o)&&void 0!==e[o]&&(r[o]=e[o]);return r}function pt(t){var e=t&&t.userAgent;if(!e)return!1;var n=st(e);return["AP","AF","AFW","BK","AM","APHK","KB"].indexOf(n.name)>=0}function ht(t,e,n){var r=e||window.document;r.addEventListener?r.addEventListener(t,n,!0):r.attachEvent?r.attachEvent("on".concat(t),n):r[t]=n}function vt(t,e,n){var r=e||window.document;r.removeEventListener?r.removeEventListener(t,n,!0):r.detachEvent?r.detachEvent("on".concat(t),n):r[t]=n}function gt(t,e){return t&&t.getAttribute&&t.getAttribute(e)||""}function mt(t,e){var n=t.id?"".concat(t.id):"",r=t.className?"".concat(t.className):"",o=t.tagName.toLowerCase(),i=n||r,a=[];n&&a.push('[@id="'.concat(n,'"]')),r&&a.push('[@class="'.concat(r,'"]'));var c="".concat(o).concat(i?a.join(""):"");return t.parentNode&&t.parentNode.tagName&&e-1!=0?"".concat(mt(t.parentNode,e-1),">").concat(c):c}var yt="data-aspm";var bt=window;var wt=document,Et=wt.documentElement,St=function(){function t(){var e=this;r(this,t),this.lastAction="0".concat(ft(),""),this.setLastActionTimer=!1,ht("scroll",document,(function(t){e.setLastActionTimer||(e.setLastActionTimer=!0,setTimeout((function(){e.setLastActionTimer=!1}),300),e.setLastAction(t))})),ht("click",document,(function(t){e.setLastAction(t)}))}return i(t,[{key:"setLastAction",value:function(t){try{var e=[],n="click"===t.type;e.push(n?1:2);var r=n?"".concat(mt(t.target,5)):"";e.push(r),e.push(ft());var o=n?"".concat(t.x,"x").concat(t.y):"".concat(Et.scrollLeft+wt.body.scrollLeft,"x").concat(Et.scrollTop+wt.body.scrollTop);e.push(o);var i=t.target&&t.target.innerText,a=i?"".concat(i.slice(0,8)):"";e.push(a),this.lastAction=e.join("")}catch(t){}}},{key:"get",value:function(){return this.lastAction}}]),t}(),Ct=["connectEnd","connectStart","decodedBodySize","domComplete","domContentLoadedEventEnd","domContentLoadedEventStart","domInteractive","domainLookupEnd","domainLookupStart","duration","encodedBodySize","fetchStart","loadEventEnd","loadEventStart","redirectCount","redirectEnd","redirectStart","requestStart","responseEnd","responseStart","secureConnectionStart","transferSize","type","unloadEventEnd","unloadEventStart","workerStart","firstPaint","firstContentfulPaint","firstMeaningfulPaint"];function At(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;e>r;r++)n[r-1]=arguments[r];var o=t.split("%s").map((function(t,e){return t&&"".concat(t).concat(n[e])})).join("");console.warn(o)}var Ot=it.ErrorCodeEnums,It=document,_t=It.documentElement,jt=(new Date).getTime(),Pt=function(){function t(e){var o=this;r(this,t),this.eventId=void 0,this.bmAppid=void 0,this.debug=void 0,this.beforeLog=void 0,this.server="https://collect.alipay.com/yuyan/",this.userConfig={},this.oncePerSession=void 0,this.defaults={},this.cOfflineVer="",this.cAppId="",this.cUserId="",this.autoCapture=void 0,this.disableInterface=void 0,this.trackedLogs=[],this.requiredFields=[],this.isErrorHandler=!1,this.lastActionComp=void 0,this.enabledPlugins=[],this.forceHttpReport=!1,this.monitorConfigInited=!1,this.monitorConfigFailed=!1,this.monitorOptions=[],this.getErrorEventHandler=function(t){o.handleErrorEvent(t,(function(t){o.log(t,{reportDirectly:!0})}))},this._warn=function(){var t=window;if("object"===n(t)&&t.console&&"function"==typeof t.console.warn&&o.debug){for(var e=arguments.length,r=Array(e),i=0;e>i;i++)r[i]=arguments[i];var a=Array.prototype.slice.call(r);t.console.warn.call(null,"[Monitor Debug]".concat(a[0]),a.slice(1))}},this.sendData=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"L",n=t.join("$$");return o.debug&&console.log("send",t),fetch("".concat(o.server,"?biztype=yuyanmonitor").concat(e.toLowerCase()),{method:"POST",headers:{"Content-type":"application/x-www-form-urlencoded",Host:"collect.alipay.com"},body:"data=".concat(n,"&time=").concat((new Date).getTime())}).catch((function(){try{(new Image).src="".concat(o.server,"?data=").concat(n,"&time=").concat((new Date).getTime())}catch(t){At("通过 IMG 上报失败: %s",t)}}))};var i=et().process(e);this.userConfig=i,this.eventId=i.eventId||"102022",this.bmAppid=i.bmAppid,this.debug=i.debug||!1,this.autoCapture=i.autoCapture,this.disableInterface=i.disableInterface,this.lastActionComp=new St,this.oncePerSession=i.oncePerSession,this.beforeLog=i.beforeLog,this.defaults=i.defaults||{},this.requiredFields=i.requiredFields||[],this.enabledPlugins=i.plugins,this.forceHttpReport=!!i.forceHttpReport}return i(t,[{key:"handleErrorEvent",value:function(t,e){try{var n=t.target||t.srcElement;if(!n)return;if("unhandledrejection"===t.type){var r=t.reason||{};if(r.message&&r.stack)this.logError(r,{code:Ot.PROMISEREJECTION});else{var o=r.message||("string"==typeof r?r:JSON.stringify(r));e({code:Ot.PROMISEREJECTION,msg:o})}return}if(n instanceof HTMLElement){var i=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.src||t.href;return"img"===t.tagName.toLowerCase()&&0===e.indexOf("data:")&&(e=e.split(",")[0]),e}(n),a=n.tagName.toLowerCase(),c=n.alt,s=void 0===c?"":c;return void e({code:Ot.ASSETS,msg:i===location.href?"__EMPTY__SRC__":i||"",s1:a,s2:mt(n,5),s3:s})}if(t.error&&t.error.stack)return void this.logError(t.error);e({code:Ot.JS,msg:t.message,s3:0})}catch(t){At("handleErrorOptions failed: %s",t.message)}}},{key:"handlePreCapture",value:function(){var t=this,e=window.g_monitor;if(e){var n=e.listener,r=void 0===n?{}:n,o=e.events,i=void 0===o?[]:o;for(var a in r)r.hasOwnProperty(a)&&(vt(a,window,r[a]),delete r[a]);for(var c=0;i.length>c;c++)this.handleErrorEvent(i[c],(function(e){t.log(e)}));e.events=[]}}},{key:"register",value:function(){if(this.autoCapture)try{if(!It)return At("当前为非 web 环境，不支持报错监听与插件使用"),this;if(this.isErrorHandler)return void At("错误事件已监听");ht("error",window,this.getErrorEventHandler),ht("unhandledrejection",window,this.getErrorEventHandler),this.isErrorHandler=!0}catch(t){At("异常监听事件注册失败: %s",t.message)}else At("已通过 autoCapture 禁用异常捕获")}},{key:"unregister",value:function(){vt("error",window,this.getErrorEventHandler),vt("unhandledrejection",window,this.getErrorEventHandler),this.isErrorHandler=!1}},{key:"isBridgeReport",value:function(){return!!window.AlipayJSBridge}},{key:"getNetwork",value:function(){var t=navigator;return t&&t.connection&&t.connection.effectiveType?t.connection.effectiveType:""}},{key:"parseParam4",value:function(t){if(!t||"object"!==n(t))return null;var r=e(e({},this.defaults),t);(t.bmAppid||this.bmAppid)&&(r.bm_appid=t.bmAppid||this.bmAppid),this.userConfig.sprintId&&(r.bm_sid=this.userConfig.sprintId),this.userConfig.env&&(r.env=this.userConfig.env),this.userConfig.yuyanId&&(r.yuyan_id=this.userConfig.yuyanId),r.monitor_ver="websdk:0.0.0-S926869747.3",r.title=r.title||document.title,r.dom_cnt=document.getElementsByTagName("*").length,r.delay=(new Date).getTime()-jt,r.scroll_top=_t.scrollTop+It.body.scrollTop,r.content_height=Math.max(_t.clientHeight,_t.offsetHeight,_t.scrollHeight),r.last_action=this.lastActionComp.get(),r.network=this.getNetwork(),r.s_c=!this.monitorConfigFailed;var o=this.userConfig.spmAPos&&this.userConfig.spmBPos?"".concat(this.userConfig.spmAPos,".").concat(this.userConfig.spmBPos):"";if(o&&(r.spmId=o),r.fullURL=r.fullURL||location.href,this.cOfflineVer&&(r.c_offline_ver=this.cOfflineVer),this.cAppId&&(r.c_app_id=this.cAppId),"object"===n(r)){var i=r;for(var a in i)if(i.hasOwnProperty(a)&&"string"==typeof i[a]){var c=i[a].replace(/\s+/g," ");i[a]="fullURL"===a&&c.length>300?c.slice(0,300):c}}return r}},{key:"bridgeLog",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"L";if(window.AlipayJSBridge){var n=t||{};window.AlipayJSBridge.call("handleLoggingAction",{actionType:"reportEvent",params:{eventId:this.eventId,bizType:"yuyanmonitor".concat(e.toLowerCase()),extData:n}})}else At("非容器环境，不能调用 handleLoggingAction")}}]),t}();var Tt="_YUYAN_COOKIE_monitor_config_next",kt=function(){function t(){r(this,t)}return i(t,[{key:"getStorageInfoMap",value:function(){var t=function(t){try{var e,n;return null===(e=window)||void 0===e||null===(n=e.localStorage)||void 0===n?void 0:n.getItem(t)}catch(t){return At("从 localStorage 中获取配置失败"),null}}(Tt)||"{}";try{return JSON.parse(t)}catch(t){return{}}}},{key:"getMonitorConfig",value:function(t){var e=this.getStorageInfoMap()[t];return!e||(new Date).valueOf()>e.expire?null:e.config}},{key:"saveMonitorConfig",value:function(t,e){var n=this.getStorageInfoMap();n[t]={config:e,expire:(new Date).valueOf()+9e5},function(t,e){try{var n,r;null===(n=window)||void 0===n||null===(r=n.localStorage)||void 0===r||r.setItem(t,e)}catch(t){return At("写入 localStorage 失败"),null}}(Tt,JSON.stringify(n))}}]),t}(),Lt=function(){function t(){r(this,t),this.monitor=void 0,this.configStorage=new kt}return i(t,[{key:"apply",value:function(t){this.monitor=t;var e=t.bmAppid||t.userConfig.yuyanId;this.enhance(t,e);try{this.fetchMonitorConfig(e)}catch(t){this.monitor.onFetchConfigError(t)}}},{key:"enhance",value:function(t,e){var n=this;Y(t,{initMonitorConfigs:function(r){t.setMonitorConfigs(r),n.configStorage.saveMonitorConfig(e,r)},setMonitorConfigs:function(e){t.monitorOptions=e.monitors,t.monitorConfigInited=!0,t.onMonitorConfigInited()}})}},{key:"fetchMonitorConfig",value:function(t){var e=this.monitor,n=e.setMonitorConfigs,r=this.configStorage.getMonitorConfig(t);if(r)return n(r);this.fetchRemoteConfigJson(t)}},{key:"fetchRemoteConfigJson",value:function(t){var e=this;fetch("https://render.alipay.com/p/alertserver/".concat(t,"_config/index.json"),{redirect:"follow"}).then((function(t){return t.json()})).then((function(t){e.monitor.initMonitorConfigs(t)})).catch((function(t){e.monitor.onFetchConfigError(t)}))}}]),t}(),Mt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var Ft=function(t,e,n){return t(n={path:e,exports:{},require:function(t,e){return function(){throw Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}()}},n.exports),n.exports}((function(t){var e,n;e="undefined"!=typeof self?self:Mt,n=function(){if("object"==typeof window){var t,e=window,n={0:"navigate",1:"reload",2:"back_forward"},r=["unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart"];return e&&e.performance&&"object"==typeof e.performance&&e.performance.timing?"function"==typeof e.performance.getEntries&&"function"==typeof e.performance.getEntriesByType&&"function"==typeof e.performance.getEntriesByName&&"function"==typeof e.performance.now&&e.performance.timeOrigin?e.performance:t={_entry:function(){for(var t=e.performance.timing,o=t.navigationStart||t.redirectStart||t.fetchStart,i={entryType:"navigation",initiatorType:"navigation",name:e.location.href,startTime:0,duration:t.loadEventEnd?t.loadEventEnd-o:0,redirectCount:e.performance.navigation.redirectCount,type:n[e.performance.navigation.type]},a=0;r.length>a;a++){var c=r[a],s=t[c];i[c]=s?s-o:0}return i}(),timeOrigin:e.performance.timing.navigationStart,getEntries:function(){return[this._entry]},getEntriesByType:function(t){return"navigation"!==t?[]:[this._entry]},getEntriesByName:function(t){return t!==e.location.href?[]:[this._entry]},now:function(){return Date.now()-e.performance.timing.navigationStart}}:t}},t.exports?t.exports=n():e.timing2=n()}));var Rt=function(t){var e=t.records,n=t.start,r=t.timeout,o=t.load;if(0===e.length)return"number"==typeof r?r:0;"number"==typeof o&&e.forEach((function(t){t.weight=Math.pow(.5,Math.abs(parseFloat(t.t)-o)/1e3)}));var i=e.map((function(t,n){if(0===n)return 0;var r=e[n-1];return t.domCnt===r.domCnt?0:(t.domCnt-r.domCnt)/(t.t-r.t)*("number"==typeof t.weight?t.weight:1)})),a=Math.max.apply(null,i),c=i.indexOf(a);return e[c].t-n},Bt="number"==typeof __PAINTY_STACK_LIMIT__?__PAINTY_STACK_LIMIT__:100;function xt(){return"object"==typeof performance&&"function"==typeof performance.now?performance.now():Date.now()}function Nt(t,r){if("object"!==n(t)||"function"!=typeof t.getEntriesByType)return null;var o=t.getEntriesByType("navigation");if(!o||0===o.length)return null;var i=o[0],c=function(t){if("object"!==n(t))return[];var e=t.getEntriesByType("paint"),r={};if(e.length){var o=(e.filter((function(t){return"first-paint"===t.name}))[0]||{}).startTime,i=(e.filter((function(t){return"first-contentful-paint"===t.name}))[0]||{}).startTime;r.firstPaint=parseFloat(o),r.firstContentfulPaint=parseFloat(i)}return r}(t),s={firstMeaningfulPaint:r};return Ct.reduce((function(t,n){var r=i[n]||c[n]||s[n];return e(e({},t),{},a({},"".concat(n),null==r||"number"==typeof r&&isNaN(r)?0:r))}),{})}function Dt(t,e){return t?function(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=isNaN(t[n])?0:Math.round(Math.min(Math.max(0,parseFloat(t[n])),3e5)));return e}({m1:e.duration||parseFloat(t.loadEventEnd)-e.startTime,m2:parseFloat(t.domContentLoadedEventStart)-e.startTime,m3:parseFloat(t.domComplete)-e.startTime,m4:t.firstPaint,m5:t.firstContentfulPaint,m6:t.firstMeaningfulPaint,m7:parseFloat(t.redirectEnd)-parseFloat(t.redirectStart),m8:parseFloat(t.domainLookupStart)-parseFloat(t.fetchStart),m9:parseFloat(t.domainLookupEnd)-parseFloat(t.domainLookupStart),m10:parseFloat(t.connectEnd)-parseFloat(t.connectStart),m11:parseFloat(t.connectEnd)-parseFloat(t.secureConnectionStart),m12:parseFloat(t.responseStart)-parseFloat(t.requestStart),m13:parseFloat(t.responseEnd)-parseFloat(t.responseStart),m14:parseFloat(t.domComplete)-parseFloat(t.responseEnd),m15:parseFloat(t.loadEventEnd)-parseFloat(t.responseEnd),m16:parseFloat(t.domInteractive)-e.startTime,m17:parseFloat(t.domContentLoadedEventEnd)-parseFloat(t.domContentLoadedEventStart),m18:parseFloat(t.domComplete)-e.startTime}):{}}var Ht=null;function qt(t,r){if("object"===n(r)&&!t.metricsSent)try{var o,i,a=r.getEntriesByType("navigation")[0],c=Nt(r,Ht),s={d1:(null===(o=navigator)||void 0===o||null===(i=o.connection)||void 0===i?void 0:i.effectiveType)||"-",d2:0===a.duration?1:0,d3:document.hidden?0:1},u={c1:document.title};t.log(e(e(e({code:"32767",msg:location.href},Dt(c,a)),s),u)),t.metricsSent=!0}catch(t){}}var Jt=function(){function t(){r(this,t),this.monitor=void 0}return i(t,[{key:"apply",value:function(t){if(this.monitor=t,"object"===n(Ft))try{!function(t,e){if("object"==typeof window&&"object"==typeof Ft){"function"==typeof t&&(e=t);var n=[],r=function t(){if("function"==typeof MutationObserver){var e=new MutationObserver((function(){n.push({t:xt(),domCnt:document.getElementsByTagName("*").length}),n.length===Bt&&i()}));return e.observe(document,{childList:!0,subtree:!0}),e.disconnect.bind(e)}var r=setTimeout((function(){n.push({t:xt(),domCnt:document.getElementsByTagName("*").length}),n.length===Bt?i():t()}),200);return function(){clearTimeout(r)}}();if("number"==typeof t)setTimeout(i,t);else{var o=!!navigator.userAgent.match(/iPhone|iPad|iPod/i);window.addEventListener(o?"pagehide":"beforeunload",i)}}function i(){if(r(),"object"==typeof Ft&&"function"==typeof Ft.getEntriesByType){var o=Ft.getEntriesByType("navigation");if(o&&o.length){var i=o[0];e(Rt({records:n,start:i.startTime,timeout:t,load:i.duration}))}}}}((function(t){Ht=t})),"function"==typeof Ft.setResourceTimingBufferSize&&Ft.setResourceTimingBufferSize(500);var e=!!navigator.userAgent.match(/iPhone|iPad|iPod/i);window.addEventListener(e?"pagehide":"beforeunload",qt.bind(null,t,Ft))}catch(t){}}}]),t}(),Ut=function(){function t(e){var n=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"l";r(this,t),this.cache=[],this.cacheSize=0,this.bizType=void 0,this.timer=void 0,this._send=void 0,this.send=function(){n.cache.length&&(n._send(n.cache,n.bizType),n.cache.length=0,n.cacheSize=0,n.resetTimer())},this._send=e,this.bizType=o}return i(t,[{key:"add",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e)return this._send([encodeURIComponent(t.join(","))]);this.addToCache(t)}},{key:"addToCache",value:function(t){var e=encodeURIComponent(t.join(",")),n=function(t){return t.split(/%..|./).length-1}(e);this.cacheSize+n>1048476&&this.send(),this.cache.push(e),this.cacheSize+=n,this.resetTimer()}},{key:"resetTimer",value:function(){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(this.send,5e3)}}]),t}(),zt={};function $t(t,e){if(zt[t])return e(null,!0);fetch("https://dataservice.alipayobjects.com/alertserver/hash/".concat(t)).then((function(n){return 200===n.status||304===n.status?(zt[t]=!0,e(null,!0)):e(null,!1)})).catch((function(t){return e(t,!1)}))}var Yt=it.ErrorCodeEnums,Kt=window,Qt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(o,t);var e=l(o);function o(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{appType:"H5"};return r(this,o),(t=e.call(this,n)).isAlipay=void 0,t.jsBridgeReady=!1,t.commandCache=[],t.requestQueue={l:new Ut(t.sendData,"l"),m:new Ut(t.sendData,"m"),h:new Ut(t.sendData,"h")},t.monitorOptionMap={},t.UserConfig={},t.destroyed=!1,(new Lt).apply(u(t)),-1!==t.enabledPlugins.indexOf("performance")&&(new Jt).apply(u(t)),t.isAlipay=pt(Kt.navigator),t.initJsBridge(),t.fetchConfig(),t.handlePreCapture(),t.register(),t}return i(o,[{key:"log",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;if(t){var n=this.isAlipay&&!this.jsBridgeReady;((null==e?void 0:e.forceHttpReport)||!n&&this.monitorConfigInited)&&$(this.userConfig,this.requiredFields,this._warn.bind(this))?this._log(t,e):this.commandCache.push([t,e])}}},{key:"logError",value:function(t,e){!function(t,e,n){var r=n.log,o=n._warn,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};try{var a=(null==i?void 0:i.code)||ot.JS,c="";if(t)if(t.stack){var s=at.stackFormatter(t),u=s.hash,f=s.stackList;c=u,u&&f&&f.length&&e(u,(function(t,e){if(t)return o("hash检测失败",t);e||r(D(D({},i),{},{code:ot.JS,s1:u,s2:x(f),s3:1}))})),r(D({code:a,msg:t.message,s10:c},i))}else r(D({code:a,msg:t.message||t},i))}catch(t){o("异常上报失败:",t)}}(t,$t,{log:this.log.bind(this),_warn:this._warn.bind(this)},e)}},{key:"logRequestError",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{if(!t)return;var e=t.type,n=void 0===e?"http":e;if("http"===n){var r=t.status,o=t.url,i=t.method,a=t.query,c=t.data,s=t.response,u=t.traceId,f=t.code,l="".concat(i.toUpperCase()," ").concat(o),d={code:f||2,msg:l};r&&(d.s1=r),a&&(d.s2=a),c&&(d.s3=c),s&&(d.s4=s),u&&(d.s5=u),this.log(d)}}catch(t){At("接口异常上报失败:%s",t)}}},{key:"config",value:function(t){t&&"object"===n(t)&&(!function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}(this.userConfig,t),t.beforeLog&&(this.beforeLog=t.beforeLog),$(this.userConfig,this.requiredFields,this._warn.bind(this))&&this.logCache())}},{key:"destroy",value:function(){this.unregister(),this.destroyed=!0}},{key:"logCache",value:function(){for(var t=this.commandCache,e=0;t.length>e;e++){var n=t[e];Array.isArray(n)&&this._log(n[0],n[1])}this.commandCache=[]}},{key:"_log",value:function(t,e){var n=function(t,e){var n,r=e.beforeLog,o=e._warn;if(e.destroyed)o("destroyed");else{if("function"==typeof r)try{t=r(t)}catch(t){o("beforeLog 失败：",t)}if(!t||"object"!==H(t)&&Array.isArray(t))o("beforeLog返回值不是对象，不进行上报");else{var i=[t.code,t.msg||"",t.uid].join("_");if(!(null!==(n=t.oncePerSession)&&void 0!==n?n:e.oncePerSession)||!ct[i]){if((t.bmAppid||e.bmAppid)===e.bmAppid){if(t.code+""=="32767")return t;var a=e.monitorOptionMap[Number(t.code)]||e.monitorOptionMap["".concat(t.code)];if(!e.monitorConfigFailed&&!a)return void e._warn("监控平台没有该监控项的配置: ".concat(t.code));if(a){var c=a.sampleRate||t.sampleRate||1;if(Math.random()>Number(c))return void o("当前已设置采样率 ".concat(c,"，未被采集"));Y(t,{sampleRate:c}),a.level&&Y(t,{level:a.level});for(var s={},u=a.fields||[],f=0;u.length>f;f++)s[u[f]]=!0;for(var l in t)!s[l]&&/^[dmc]\d+$/.test(l)&&delete t[l]}}return ct[i]=1,t}e._warn("当前由于 OncePerSession 策略，未被采集")}}}(t,this);if(n){this.getSpmInfo();var r=this.parseParam4(n);if(this.userConfig.forceHttpReport||!!(null==e?void 0:e.forceHttpReport)||!this.isBridgeReport()){var o=n.roleId||this.userConfig.userId||this.cUserId||"";delete n.roleId;var i=navigator.userAgent?navigator.userAgent.replace(/,/g,"%2C"):"",a=lt({eventId:this.eventId,userId:o,param4:r,ua:i});if(!a.length)return;return(this.requestQueue[n.level]||this.requestQueue.l).add(a,null==e?void 0:e.reportDirectly)}r._ua=navigator.userAgent?navigator.userAgent.replace(/,/g,"%2C"):"";for(var c=0,s=Object.keys(r);s.length>c;c++){var u=s[c];r[u]=ut(r[u])}this.bridgeLog(r,n.level)}}},{key:"getSpmInfo",value:function(){var t=window._to||{};if(!this.userConfig.spmAPos){var e=function(t){for(var e,n,r,o,i=function(t){var e,n;try{return[].slice.call(t)}catch(o){e=[],n=t.length;for(var r=0;n>r;r++)e.push(t[r]);return e}}(t||document.getElementsByTagName("meta")),a=i.length,c=0;a>c;c++)if(n=gt(e=i[c],"name"),r=gt(e,"content"),n===yt&&r){o=r;break}var s={};return o&&(s.spmAPos=o),s}().spmAPos||t.spmAPos;e&&(this.userConfig.spmAPos=e)}if(!this.userConfig.spmBPos){var n=gt(document.body,yt)||t.spmBPos;n&&(this.userConfig.spmBPos=n)}}},{key:"initJsBridge",value:function(){var t=this;document.addEventListener("AlipayJSBridgeReady",(function(){t.onJsBridgeReady()}))}},{key:"getInfoFromBridge",value:function(t){var e=this,n=2;function r(){0===--n&&t()}try{var o=Kt.AlipayJSBridge;o.call("getUserInfo",(function(t){e.cUserId=t.userId,r()})),o.call("getStartupParams",(function(t){e.cOfflineVer=t.version,t.version&&(e.cAppId=t.appId),r()}))}catch(e){t(),At("调用容器接口获取信息失败:%s",e.message)}}},{key:"onJsBridgeReady",value:function(){var t=this;this.getInfoFromBridge((function(){t.jsBridgeReady=!0,t.monitorConfigInited&&t.logCache()}))}},{key:"set",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};dt(this,t)}},{key:"setMonitorConfigs",value:function(){}},{key:"initMonitorConfigs",value:function(t){}},{key:"fetchConfig",value:function(){}},{key:"fetchConfigByRequest",value:function(){}},{key:"fetchConfigByJSBridge",value:function(){}},{key:"onMonitorConfigInited",value:function(){var t=this;this.monitorOptions&&this.monitorOptions.forEach((function(e){e&&e.code&&(t.monitorOptionMap[e.code]=e)}));var e=this.monitorOptionMap[Yt.REQUEST];!this.disableInterface&&e&&(e.code===Yt.REQUEST&&e.isActive&&!e.isDeleted&&function(t){var e=!1;if("XMLHttpRequest"in bt){var n=bt.XMLHttpRequest.prototype,r=n.open;n.open=function(t,e){this.__interfaceMonitor__={method:t,url:e||"",status_code:null};for(var n=Array(arguments.length),o=0;n.length>o;++o)n[o]=arguments[o];r.apply(this,n)};var o=n.send;n.send=function(n){var r=this;function i(){if(r.__interfaceMonitor__&&4===r.readyState)try{var o=r.__interfaceMonitor__.url;if(0===r.status)return;var i=o.split("?")[0],a=o.split("?")[1]||"",c="string"==typeof n?n:JSON.stringify(n),s=r.response+"";if(s.length>2048&&(s="[too large]"),200>r.status||r.status>299||e){if(i===t.server)return void t._warn("上报异常",c);t.logRequestError({type:"http",status:r.status,url:i,method:r.__interfaceMonitor__.method,query:a,data:c,response:s,traceId:t.traceId||""})}}catch(e){t._warn("接口异常上报失败:",e)}}if("onreadystatechange"in r&&"function"==typeof r.onreadystatechange){var a=r.onreadystatechange;r.onreadystatechange=function(){for(var t=Array(arguments.length),e=0;t.length>e;++e)t[e]=arguments[e];i.apply(this,t),a.apply(this,t)}}else r.onreadystatechange=i;for(var c=Array(arguments.length),s=0;c.length>s;++s)c[s]=arguments[s];return o.apply(this,arguments)}}if("fetch"in bt){var i=bt.fetch;bt.fetch=function(){for(var n=Array(arguments.length),r=0;n.length>r;++r)n[r]=arguments[r];var o="GET";return n[1]&&n[1].method&&(o=n[1].method.toUpperCase()),i.apply(this,n).then((function(r){return new Promise((function(i){try{var a=n[0],c=a.split("?")[0],s=a.split("?")[1]||"",u=n[1]&&n[1].body||"",f="string"==typeof u?u:JSON.stringify(u);r.clone().text().then((function(n){r.ok&&!e||t.logRequestError({type:"http",status:r.status,url:c,method:o,query:s,data:f,response:(n||"").length>2048?"[too large]":n,traceId:t.traceId||""})})).then((function(){i(r)}),(function(){i(r)}))}catch(t){i(r)}}))}))}}}(this));this.isAlipay&&!this.jsBridgeReady||this.logCache()}},{key:"onFetchConfigError",value:function(t){this.monitorConfigInited=!0,this.monitorConfigFailed=!0,this.onMonitorConfigInited(),At("获取服务端配置失败：%s",t.message)}}]),o}(Pt);return Qt}));
